<div class="col-md-8 col-md-offset-1">
  <% @response.each_with_index do |t, i| %>
    <div class="row">
      <h5>Flight Option <%= i + 1 %></h5>
      <% t["slice"].each do |s| %>
        <div class="col-md-12 col-md-offset-1">
          <p>Total Duration: <%= formatted_duration(s["duration"]) %></p>
        </div>
        <% s["segment"].each do |sg| %>
          <div class="col-md-12 col-md-offset-2">
            <% sg["leg"].each do |l| %>
              <div class="col-md-6">
                <p>Flight: <%= "#{sg["flight"]["carrier"]} #{sg["flight"]["number"]}" %></p>
                <p> Origin: <%= l["origin"] %> </p>
                <p> Departure Time: <%= l["departureTime"].to_time.strftime('%A, %d %b %Y %l:%M %p') %> </p>
                <p> Origin Terminal: <%= l["originTerminal"] %> </p>
                <p> Duration: <%= formatted_duration(l["duration"]) %> </p>
              </div>
              <div class="col-md-6">
                <p> Aircraft: <%= l["aircraft"] %> </p>
                <p> Destination: <%= l["destination"] %> </p>
                <p> Arrival Time: <%= l["arrivalTime"].to_time.strftime('%A, %d %b %Y %l:%M %p') %> </p>
                <p> Destination Terminal: <%= l["destinationTerminal"] %> </p>
              </div>
            <% end %>
            <% if sg["connectionDuration"].to_i > 0 %>
              <p>Transit Duration: <%= formatted_duration(sg["connectionDuration"])%></p>
            <% end %>
            <hr></hr>
          </div>
        <% end %>
      <% end %>
      <p class="col-md-3 col-md-offset-6">
        <strong>Cost: <%= t["saleTotal"] %></strong>
        <!-- <%= link_to "Request Quote !", quote_request_path(params: params), class: "btn btn-md btn-success" %> -->
        <%= link_to "Request Quote !", '#', id: 'bookflight', class: "btn btn-md btn-success", "data-id" => i , "data-toggle" => "modal", 'data-target' => '#myModalNorm' %>
      </p>
      <hr></hr>
    </div>
  <% end %>
</div>


<!-- Modal -->
<div class="modal fade" id="myModalNorm" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close"
                   data-dismiss="modal">
                       <span aria-hidden="true">&times;</span>
                       <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Request Quote !
                </h4>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
              <p>
                Call us at 014246203, 9843935546 (Umesh Gurung) for quote request via telephone
                <p>Or visit our office at Putalisadak, Kathmandu</p>
                <iframe style="border: 0;" src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d1766.1698845031037!2d85.32272498531952!3d27.706793894264827!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x6b5b07c0666bc159!2sFeel+Home+Travels+%26+Tours!5e0!3m2!1sen!2snp!4v1486042042109" width="100%" height="100%" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
              </p>
              <hr></hr>
              <% unless current_user %>
                <strong>Or sign up below for online request !</strong>

                  <br></br>
                  <%= bootstrap_form_for(@user, as: :user, url: user_registration_path(@user)) do |f| %>
                    <%= hidden_field_tag "flight_data", @response[session[:flight_number].to_i].to_json %>
                    <%= f.text_field :name, required: true, label: "Full Name", pattern: ".{5,}", title: "5 characters minimum"%>
                    <%= f.email_field :email, required: true, pattern: ".{5,}", title: "5 characters minimum", required: true, type:'email' %>
                    <%= f.telephone_field :contact_number, required: true, pattern: "[0-9]{7,}", maxlength:"13", title: "Input Valid Contact Number, Between 7 to 13 Digit" %>
                    <%= f.password_field :password, required: true, label: "Set Password", help: "Must be at least 8 characters", pattern: ".{8,}", title: "Must be at least 8 characters" %>
                    <%= f.submit "Sign Up & Request Quote", class: "btn btn-success btn-lg" %>
                  <% end %>
              <% else %>
                <%= form_for(@booking) do |f| %>
                  <%= hidden_field_tag "flight_data", @response[session[:flight_number].to_i].to_json %>
                  <%= f.submit "Request Quote", class: "btn btn-success btn-lg" %>
                <% end %>
              <% end %>
            </div>

        </div>
    </div>
</div>

<script type="text/javascript">
  $(document).on("click", "#bookflight", function () {
    var myBookId = $(this).data('id');
    $(".modal-body #ticketNo").val( myBookId );
    $.ajax({
      url: '/booking/set_flight',
      data: {flight_number: myBookId},
      type: 'post'
    })
  });
</script>
